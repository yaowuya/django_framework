(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["show-model"],{"12d0":function(e,t,r){},2532:function(e,t,r){"use strict";var n=r("23e7"),a=r("5a34"),s=r("1d80"),i=r("ab13");n({target:"String",proto:!0,forced:!i("includes")},{includes:function(e){return!!~String(s(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},"5a34":function(e,t,r){var n=r("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},8068:function(e,t,r){"use strict";var n=r("a3af"),a=r.n(n);a.a},"92d5":function(e,t,r){"use strict";var n=r("12d0"),a=r.n(n);a.a},"945e":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"drawer-body"},[r("CwDrawerHeader",{attrs:{title:e.title},on:{"go-back":function(t){return e.goBack()}}}),r("div",{staticClass:"app-container"},[e._t("default")],2)],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"drawer-header"},[r("div",{staticClass:"back",on:{click:function(t){return t.stopPropagation(),e.goBack()}}},[r("Icon",{attrs:{type:"ios-arrow-forward"}})],1),r("p",{staticClass:"header-p"},[e._v(e._s(e.title))])])},i=[],o={name:"CwDrawerHeader",props:{title:{type:String,default:function(){return""}}},data:function(){return{}},methods:{goBack:function(){this.$emit("go-back")}}},c=o,u=r("2877"),l=Object(u["a"])(c,s,i,!1,null,"e6489ac0",null),d=l.exports,p={name:"CwDrawerBody",components:{CwDrawerHeader:d},props:{title:{type:String,required:!0}},methods:{goBack:function(){this.$emit("go-back")}}},m=p,f=Object(u["a"])(m,n,a,!1,null,"1c0407ea",null);t["a"]=f.exports},a3af:function(e,t,r){},a434:function(e,t,r){"use strict";var n=r("23e7"),a=r("23cb"),s=r("a691"),i=r("50c4"),o=r("7b0b"),c=r("65f0"),u=r("8418"),l=r("1dde"),d=r("ae40"),p=l("splice"),m=d("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,g=Math.min,h=9007199254740991,b="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!p||!m},{splice:function(e,t){var r,n,l,d,p,m,w=o(this),v=i(w.length),_=a(e,v),k=arguments.length;if(0===k?r=n=0:1===k?(r=0,n=v-_):(r=k-2,n=g(f(s(t),0),v-_)),v+r-n>h)throw TypeError(b);for(l=c(w,n),d=0;d<n;d++)p=_+d,p in w&&u(l,d,w[p]);if(l.length=n,r<n){for(d=_;d<v-n;d++)p=d+n,m=d+r,p in w?w[m]=w[p]:delete w[m];for(d=v;d>v-n+r;d--)delete w[d-1]}else if(r>n)for(d=v-n;d>_;d--)p=d+n-1,m=d+r-1,p in w?w[m]=w[p]:delete w[m];for(d=0;d<r;d++)w[d+_]=arguments[d+2];return w.length=v-n+r,l}})},a7f6:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"show-model"},[r("Form",{ref:"formInline",attrs:{model:e.formInline,inline:""}},[r("FormItem",{attrs:{label:"模板名称","label-width":70}},[r("i-input",{attrs:{placeholder:"请输入模板名称",clearable:""},model:{value:e.formInline.model_name,callback:function(t){e.$set(e.formInline,"model_name",t)},expression:"formInline.model_name"}})],1),r("FormItem",[r("Button",{staticClass:"mr-15",attrs:{type:"success"},on:{click:e.search}},[e._v("查询")]),r("Button",{attrs:{type:"primary"},on:{click:e.create}},[e._v("添加")])],1)],1),r("CwTable",{attrs:{columns:e.columns,data:e.data,loading:e.loading,current:e.page.currentPage,total:e.page.total,"page-size":e.page.pageSize},on:{"size-change":e.sizeChange,"current-change":e.currentChange},scopedSlots:e._u([{key:"menu",fn:function(t){var n=t.row;return[r("Button",{staticClass:"mr-10",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.previewModel(n)}}},[e._v("浏览")]),r("Button",{staticClass:"mr-10",attrs:{type:"warning",size:"small",disabled:n.default},on:{click:function(t){return e.setDefault(n)}}},[e._v("设为默认")]),r("Button",{staticClass:"mr-10",attrs:{size:"small"},on:{click:function(t){return e.update(n)}}},[e._v("编辑")]),r("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return e.remove(n)}}},[e._v("删除")])]}}])}),r("Drawer",{attrs:{width:"50",closable:!1,placement:"right","class-name":"cw-drawer-wrap"},model:{value:e.drawerVisible,callback:function(t){e.drawerVisible=t},expression:"drawerVisible"}},[r("ModelOperation",{key:e.uuid,attrs:{"is-add":e.isAdd,"form-obj":e.formObj},on:{"go-back":e.goBack}})],1)],1)},a=[],s=(r("ac1f"),r("1276"),r("5530")),i=(r("96cf"),r("1da1")),o=r("f49b"),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("CwDrawerBody",{attrs:{title:e.title},on:{"go-back":e.goBack}},[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":120}},[r("FormItem",{attrs:{label:"模板名称",prop:"model_name"}},[r("i-input",{attrs:{placeholder:"请输入模板名称",clearable:"",disabled:e.isStatus},model:{value:e.form.model_name,callback:function(t){e.$set(e.form,"model_name",t)},expression:"form.model_name"}})],1),r("FormItem",{attrs:{prop:"key_business"}},[r("span",{attrs:{slot:"label"},slot:"label"},[e._v(" 关键业务 "),r("Tooltip",{attrs:{content:"关键业务将在首页固定展示",placement:"top"}},[r("Icon",{staticClass:"icon-cursor",attrs:{type:"ios-help-circle-outline"}})],1)],1),r("i-select",{attrs:{filterable:"",multiple:"",clearable:""},on:{"on-change":e.keyChange},model:{value:e.form.key_business,callback:function(t){e.$set(e.form,"key_business",t)},expression:"form.key_business"}},e._l(e.keyBusiness,(function(t,n){return r("Option",{key:n,attrs:{value:t.bk_biz_name}},[e._v(" "+e._s(t.bk_biz_name)+" ")])})),1)],1),r("FormItem",{attrs:{prop:"other_business"}},[r("span",{attrs:{slot:"label"},slot:"label"},[e._v(" 非关键业务 "),r("Tooltip",{attrs:{content:"非关键业务将在首页轮播展示",placement:"top"}},[r("Icon",{staticClass:"icon-cursor",attrs:{type:"ios-help-circle-outline"}})],1)],1),r("i-select",{attrs:{filterable:"",multiple:"",clearable:""},on:{"on-change":e.otherChange},model:{value:e.form.other_business,callback:function(t){e.$set(e.form,"other_business",t)},expression:"form.other_business"}},e._l(e.otherBusiness,(function(t,n){return r("Option",{key:n,attrs:{value:t.bk_biz_name}},[e._v(" "+e._s(t.bk_biz_name)+" ")])})),1)],1),r("FormItem",{attrs:{label:"授权用户",prop:"model_users"}},[r("i-select",{attrs:{multiple:"",clearable:""},model:{value:e.form.model_users,callback:function(t){e.$set(e.form,"model_users",t)},expression:"form.model_users"}},e._l(e.userList,(function(t,n){return r("Option",{key:n,attrs:{value:t.id}},[e._v(" "+e._s(t.bk_username+"("+t.chname+")")+" ")])})),1)],1),r("FormItem",{attrs:{label:"授权用户组",prop:"model_groups"}},[r("i-select",{attrs:{multiple:"",clearable:""},model:{value:e.form.model_groups,callback:function(t){e.$set(e.form,"model_groups",t)},expression:"form.model_groups"}},e._l(e.groupList,(function(t,n){return r("Option",{key:n,attrs:{value:t.id}},[e._v(" "+e._s(t.group_name)+" ")])})),1)],1),r("FormItem",{attrs:{label:"页面结构",prop:"page_type"}},[r("RadioGroup",{model:{value:e.form.page_type,callback:function(t){e.$set(e.form,"page_type",t)},expression:"form.page_type"}},[r("Radio",{staticClass:"mr-20",attrs:{label:"cabinet"}},[e._v("柜式")]),r("Radio",{attrs:{label:"block"}},[e._v("块式")])],1)],1),r("FormItem",{attrs:{label:"说明",prop:"desc"}},[r("i-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入说明"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),r("div",{staticClass:"center mb-10 model-footer"},[r("Button",{staticClass:"mr-15",attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),r("Button",{on:{click:e.goBack}},[e._v("取消")])],1)],1)},u=[],l=(r("4de4"),r("4160"),r("caad"),r("a434"),r("b0c0"),r("d3b7"),r("2532"),r("3ca3"),r("159b"),r("ddb0"),r("2909")),d=r("2f62"),p=r("945e"),m={name:"ModelOperation",components:{CwDrawerBody:p["a"]},props:{isAdd:{type:Boolean,default:function(){return!0}},isStatus:{type:Boolean,default:function(){return!1}},formObj:{type:Object,default:function(){return{}}}},data:function(){return{title:"添加模板",form:{model_name:"",key_business:[],other_business:[],model_users:[],model_groups:[],page_type:"cabinet",desc:""},rules:{model_name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],key_business:[{required:!0,type:"array",message:"请选择关键业务",trigger:"change"}],page_type:[{required:!0,message:"请选择页面结构",trigger:"change"}]},userList:[],groupList:[],businessList:[],keyBusiness:[],otherBusiness:[]}},computed:Object(s["a"])({},Object(d["c"])(["name"])),created:function(){var e=this;this.$Spin.show(),Promise.all([this.getAllLocalUser(),this.getAllGroup(),this.getBusinessList()]).then((function(t){e.isStatus?e.title="模板预览":e.title=e.isAdd?"添加模板":"编辑模板",e.isAdd?e.form.model_users.push(e.getUserId(e.name)):e.form=Object(s["a"])({},e.formObj),e.$Spin.hide()})).catch((function(){e.$Spin.hide()}))},methods:{getUserId:function(e){var t="";return this.userList.forEach((function(r){if(e===r.bk_username)return t=r.id,!1})),t},getAllLocalUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.sys.getAllLocalUser({});case 3:r=t.sent,r.result?e.userList=r.data:e.$CwMessage("error",r.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$CwMessage("error",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getAllGroup:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.sys.getAllGroup({});case 3:r=t.sent,r.result?e.groupList=r.data:e.$CwMessage("error",r.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$CwMessage("error",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getBusinessList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.show.getBusinessList({});case 3:r=t.sent,r.result?(e.businessList=r.data,e.keyBusiness=Object(l["a"])(e.businessList),e.otherBusiness=Object(l["a"])(e.businessList)):e.$CwMessage("error",r.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$CwMessage("error",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},keyChange:function(e){if(this.form.key_business.length>12)return this.form.key_business.splice(this.form.key_business.length-1),this.$CwMessage("error","关键业务不能超过12个"),!1;this.otherBusiness=this.businessList.filter((function(t){if(!e.includes(t.bk_biz_name))return t}))},otherChange:function(e){this.keyBusiness=this.businessList.filter((function(t){if(!e.includes(t.bk_biz_name))return t}))},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=10;break}if(!e.isAdd){t.next=6;break}return t.next=4,e.add();case 4:t.next=8;break;case 6:return t.next=8,e.edit();case 8:t.next=11;break;case 10:e.$CwMessage("error","请完善资料");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},add:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$Spin.show(),t.prev=1,t.next=4,e.$api.show.addModel({data:JSON.stringify(e.form)});case 4:r=t.sent,e.$Spin.hide(),r.result?(e.modelVisible=!1,e.$CwMessage("success","添加成功"),e.goBack("add")):e.$CwMessage("error",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.$Spin.hide(),e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},edit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$Spin.show(),t.prev=1,t.next=4,e.$api.show.editModel({data:JSON.stringify(e.form)});case 4:r=t.sent,e.$Spin.hide(),r.result?(e.modelVisible=!1,e.$CwMessage("success","编辑成功"),e.goBack("edit")):e.$CwMessage("error",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.$Spin.hide(),e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},goBack:function(e){e?this.$emit("go-back",e):this.$emit("go-back")}}},f=m,g=(r("92d5"),r("2877")),h=Object(g["a"])(f,c,u,!1,null,"621c5d59",null),b=h.exports,w={name:"Model",components:{ModelOperation:b,CwTable:o["a"]},data:function(){return{formInline:{model_name:""},loading:!1,columns:[{title:"模板名称",key:"model_name",align:"center"},{title:"授权用户",key:"model_users",align:"center",tooltip:!0},{title:"授权用户组",key:"model_groups",align:"center",tooltip:!0},{title:"创建时间",key:"create_time",align:"center",tooltip:!0},{title:"创建人",key:"create_user",align:"center"},{title:"描述",key:"desc",align:"center"},{title:"操作",slot:"menu",align:"center",width:"300px"}],data:[],page:{currentPage:1,total:0,pageSize:10},isAdd:!0,drawerVisible:!1,uuid:"",formObj:{}}},created:function(){this.query().then()},methods:{search:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.query();case 2:case"end":return t.stop()}}),t)})))()},query:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.$api.show.getAllModel({params:e.formInline,num:e.page.pageSize,page:e.page.currentPage});case 4:r=t.sent,e.loading=!1,r.result?(e.page.total=r.data.total,e.data=r.data.data):e.$CwMessage("error",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.loading=!1,e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},sizeChange:function(e){this.page.currentPage=1,this.page.pageSize=e,this.query().then()},currentChange:function(e){this.page.currentPage=e,this.query().then()},create:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.uuid=e.$uuid.v4(),e.$nextTick((function(){e.isAdd=!0,e.drawerVisible=!0}));case 2:case"end":return t.stop()}}),t)})))()},update:function(e){var t=this;this.uuid=this.$uuid.v4(),this.$nextTick((function(){t.isAdd=!1,t.formObj=Object(s["a"])({},e),t.formObj["key_business"]=t.formObj.key_business.split(";"),t.formObj["other_business"]=t.formObj.other_business.split(";"),t.formObj["model_users"]=JSON.parse(t.formObj.model_user_list),t.formObj["model_groups"]=JSON.parse(t.formObj.model_group_list),t.drawerVisible=!0}))},previewModel:function(e){this.$router.push({name:"Dashboard",params:{id:e.id}})},setDefault:function(e){var t=this;this.$CWConfirm({type:"warning",title:"设为默认",content:"是否设置这个模板为默认模板",okText:"确定",cancelText:"取消"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.show.setDefaultModel({id:e.id});case 3:if(n=r.sent,!n.result){r.next=10;break}return t.$CwMessage("success","设置成功"),r.next=8,t.query();case 8:r.next=11;break;case 10:t.$CwMessage("error",n.message);case 11:r.next=16;break;case 13:r.prev=13,r.t0=r["catch"](0),t.$CwMessage("error",r.t0);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))).catch((function(){}))},remove:function(e){var t=this;this.$CWConfirm({type:"error",title:"删除",content:"是否删除这条数据",okText:"删除",cancelText:"取消"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.show.deleteModel({id:e.id});case 3:if(n=r.sent,!n.result){r.next=10;break}return t.$CwMessage("success","删除成功"),r.next=8,t.query();case 8:r.next=11;break;case 10:t.$CwMessage("error",n.message);case 11:r.next=16;break;case 13:r.prev=13,r.t0=r["catch"](0),t.$CwMessage("error",r.t0);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))).catch((function(){}))},goBack:function(e){e&&this.query().then(),this.drawerVisible=!1}}},v=w,_=Object(g["a"])(v,n,a,!1,null,"6b2ab861",null);t["default"]=_.exports},ab13:function(e,t,r){var n=r("b622"),a=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[a]=!1,"/./"[e](t)}catch(n){}}return!1}},caad:function(e,t,r){"use strict";var n=r("23e7"),a=r("4d64").includes,s=r("44d2"),i=r("ae40"),o=i("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:!o},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},f49b:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"cw-table"},[r("Table",{attrs:{border:e.border,stripe:e.stripe,loading:e.loading,columns:e.columns,data:e.data,size:e.size},scopedSlots:e._u([e._l(e.columns,(function(t){return{key:t.slot,fn:function(n){var a=n.row,s=n.index;return[t.slot?e._t(t.slot,null,{row:a,index:s}):r("span",{key:a[t.key]},[e._v(e._s(a[t.key]))])]}}}))],null,!0)}),r("div",{staticClass:"cw-table-page"},[r("Page",{attrs:{current:e.current,total:e.total,"show-total":e.showTotal,"show-sizer":e.showSizer,"prev-text":e.prevText,"next-text":e.nextText,"page-size":e.pageSize,"page-size-opts":e.pageSizeOpts,"show-elevator":""},on:{"on-change":e.onChange,"on-page-size-change":e.onPageSizeChange}})],1)],1)},a=[],s=(r("a9e3"),{name:"CwTable",props:{border:{type:Boolean,default:function(){return!0}},stripe:{type:Boolean,default:function(){return!0}},loading:{type:Boolean,default:function(){return!1}},size:{type:String,default:function(){return"small"}},columns:{type:Array,default:function(){return[]}},data:{type:Array,default:function(){return[]}},current:{type:Number,default:function(){return 1}},total:{type:Number,default:function(){return 0}},showTotal:{type:Boolean,default:function(){return!0}},showSizer:{type:Boolean,default:function(){return!0}},pageSize:{type:Number,default:function(){return 10}},pageSizeOpts:{type:Array,default:function(){return[10,20,30,40]}},prevText:{type:String,default:function(){return"上一页"}},nextText:{type:String,default:function(){return"下一页"}}},data:function(){return{}},methods:{onChange:function(e){this.$emit("current-change",e)},onPageSizeChange:function(e){this.$emit("size-change",e)}}}),i=s,o=(r("8068"),r("2877")),c=Object(o["a"])(i,n,a,!1,null,"cc375164",null);t["a"]=c.exports}}]);