(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user-group"],{2532:function(e,t,r){"use strict";var n=r("23e7"),a=r("5a34"),s=r("1d80"),i=r("ab13");n({target:"String",proto:!0,forced:!i("includes")},{includes:function(e){return!!~String(s(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},"274d":function(e,t,r){},"2d98":function(e,t,r){"use strict";var n=r("274d"),a=r.n(n);a.a},"5a34":function(e,t,r){var n=r("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},6158:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"user-group"},[r("Tabs",{attrs:{value:"user"},on:{"on-click":e.tabChange}},[r("TabPane",{attrs:{label:"用户",name:"user"}},[r("User")],1),r("TabPane",{attrs:{label:"用户组",name:"group"}},[r("Group",{key:e.uuid})],1)],1)],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"user"},[r("Form",{ref:"formInline",attrs:{model:e.formInline,inline:""}},[r("FormItem",{attrs:{label:"用户名","label-width":55}},[r("i-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.formInline.bk_username,callback:function(t){e.$set(e.formInline,"bk_username",t)},expression:"formInline.bk_username"}})],1),r("FormItem",{attrs:{label:"中文名","label-width":60}},[r("i-input",{attrs:{placeholder:"请输入中文名",clearable:""},model:{value:e.formInline.chname,callback:function(t){e.$set(e.formInline,"chname",t)},expression:"formInline.chname"}})],1),r("FormItem",[r("Button",{staticClass:"mr-15",attrs:{type:"success"},on:{click:e.search}},[e._v("查询")]),r("Button",{attrs:{type:"primary"},on:{click:e.create}},[e._v("添加")])],1)],1),r("CwTable",{attrs:{columns:e.columns,data:e.data,loading:e.loading,current:e.page.currentPage,total:e.page.total,"page-size":e.page.pageSize},on:{"size-change":e.sizeChange,"current-change":e.currentChange},scopedSlots:e._u([{key:"menu",fn:function(t){var n=t.row;return[r("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return e.remove(n)}}},[e._v("删除")])]}}])}),r("Drawer",{attrs:{width:"50",closable:!1,placement:"right","class-name":"cw-drawer-wrap"},model:{value:e.drawerVisible,callback:function(t){e.drawerVisible=t},expression:"drawerVisible"}},[r("AddUser",{key:e.uuid,on:{"go-back":e.goBack}})],1)],1)},i=[],o=(r("96cf"),r("1da1")),c=r("f49b"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("CwDrawerBody",{attrs:{title:"添加用户"},on:{"go-back":e.goBack}},[r("Form",{ref:"formInline",attrs:{model:e.formInline,inline:""}},[r("FormItem",{attrs:{label:"用户名","label-width":60}},[r("i-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.formInline.bk_username,callback:function(t){e.$set(e.formInline,"bk_username",t)},expression:"formInline.bk_username"}})],1),r("FormItem",{attrs:{label:"中文名","label-width":60}},[r("i-input",{attrs:{placeholder:"请输入中文名",clearable:""},model:{value:e.formInline.chname,callback:function(t){e.$set(e.formInline,"chname",t)},expression:"formInline.chname"}})],1),r("FormItem",[r("Button",{attrs:{type:"success"},on:{click:e.query}},[e._v("查询")])],1)],1),r("div",{staticClass:"user-table scroll-bar"},[r("Table",{attrs:{border:!0,stripe:!0,loading:e.userLoading,columns:e.userColumns,data:e.userData},on:{"on-selection-change":e.selectionChange}})],1),r("div",{staticClass:"center mt-20 mb-10"},[r("Button",{staticClass:"mr-15",attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),r("Button",{on:{click:e.goBack}},[e._v("取消")])],1)],1)},l=[],p=(r("4160"),r("caad"),r("2532"),r("159b"),r("2909")),m=r("945e"),d={name:"AddUser",components:{CwDrawerBody:m["a"]},data:function(){return{formInline:{bk_username:"",chname:""},userLoading:!1,userColumns:[{type:"selection",width:60,align:"center"},{title:"用户名",key:"bk_username",align:"center"},{title:"中文名",key:"chname",align:"center"},{title:"用户身份",key:"role",align:"center"}],userData:[],userList:[],selectionList:[]}},created:function(){this.userData=[],this.getUserList().then()},methods:{getUserList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.userLoading=!0,t.prev=1,t.next=4,e.$api.sys.getUserList();case 4:r=t.sent,e.userLoading=!1,r.result?(e.userData=r.data,e.userList=r.data):e.$CwMessage("success",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.userLoading=!1,e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},query:function(){var e=this,t=[];this.userList.forEach((function(r){r.bk_username.includes(e.formInline.bk_username)&&t.push(r)}));var r=[];t.forEach((function(t){t.chname.includes(e.formInline.chname)&&r.push(t)})),this.userData=r},selectionChange:function(e){this.selectionList=Object(p["a"])(e)},save:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.selectionList.length){t.next=3;break}return e.$CwMessage("warning","请选择用户"),t.abrupt("return");case 3:return e.$Spin.show(),t.prev=4,t.next=7,e.$api.sys.addUserList({userList:e.selectionList});case 7:r=t.sent,e.$Spin.hide(),r.result?e.$emit("go-back","save"):e.$CwMessage("error",r.message),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](4),e.$Spin.hide(),e.$CwMessage("error",t.t0);case 16:case"end":return t.stop()}}),t,null,[[4,12]])})))()},goBack:function(){this.$emit("go-back")}}},g=d,f=(r("a5c1"),r("2877")),h=Object(f["a"])(g,u,l,!1,null,"a0e94402",null),b=h.exports,v={name:"User",components:{AddUser:b,CwTable:c["a"]},data:function(){return{formInline:{bk_username:"",chname:""},loading:!1,columns:[{title:"用户名",key:"bk_username",align:"center"},{title:"中文名",key:"chname",align:"center"},{title:"邮箱",key:"email",align:"center",width:"220px"},{title:"手机号",key:"phone",align:"center"},{title:"用户身份",key:"role",align:"center"},{title:"操作",slot:"menu",align:"center",width:"100px"}],data:[],page:{currentPage:1,total:0,pageSize:10},drawerVisible:!1,uuid:this.$uuid.v4()}},created:function(){this.query().then()},methods:{create:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.uuid=e.$uuid.v4(),e.drawerVisible=!0;case 2:case"end":return t.stop()}}),t)})))()},search:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.query();case 2:case"end":return t.stop()}}),t)})))()},query:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.$api.sys.getAllUserList({params:e.formInline,num:e.page.pageSize,page:e.page.currentPage});case 4:r=t.sent,e.loading=!1,r.result?(e.page.total=r.data.total,e.data=r.data.data):e.$CwMessage("error",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.loading=!1,e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},sizeChange:function(e){this.page.currentPage=1,this.page.pageSize=e,this.query().then()},currentChange:function(e){this.page.currentPage=e,this.query().then()},remove:function(e){var t=this;this.$CWConfirm({type:"error",title:"删除",content:"是否删除这条数据",okText:"删除",cancelText:"取消"}).then(Object(o["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.sys.deleteUserById({id:e.id});case 3:if(n=r.sent,!n.result){r.next=10;break}return t.$CwMessage("success","删除成功"),r.next=8,t.query();case 8:r.next=11;break;case 10:t.$CwMessage("error",n.message);case 11:r.next=16;break;case 13:r.prev=13,r.t0=r["catch"](0),t.$CwMessage("error",r.t0);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))).catch((function(){}))},goBack:function(e){e&&this.query().then(),this.drawerVisible=!1}}},w=v,k=Object(f["a"])(w,s,i,!1,null,"4baab1b4",null),y=k.exports,x=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"group"},[r("Form",{ref:"formInline",attrs:{model:e.formInline,inline:""}},[r("FormItem",{attrs:{label:"组名","label-width":42}},[r("i-input",{attrs:{placeholder:"请输入组名",clearable:""},model:{value:e.formInline.group_name,callback:function(t){e.$set(e.formInline,"group_name",t)},expression:"formInline.group_name"}})],1),r("FormItem",[r("Button",{staticClass:"mr-15",attrs:{type:"success"},on:{click:e.search}},[e._v("查询")]),r("Button",{attrs:{type:"primary"},on:{click:e.create}},[e._v("添加")])],1)],1),r("CwTable",{attrs:{columns:e.columns,data:e.data,loading:e.loading,current:e.page.currentPage,total:e.page.total,"page-size":e.page.pageSize},on:{"size-change":e.sizeChange,"current-change":e.currentChange},scopedSlots:e._u([{key:"menu",fn:function(t){var n=t.row;return[r("Button",{staticClass:"mr-10",attrs:{size:"small"},on:{click:function(t){return e.update(n)}}},[e._v("编辑")]),r("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return e.remove(n)}}},[e._v("删除")])]}}])}),r("Modal",{attrs:{width:450},model:{value:e.modelVisible,callback:function(t){e.modelVisible=t},expression:"modelVisible"}},[r("p",{staticClass:"text-center",attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(e.isAdd?"添加用户组":"编辑用户组"))])]),r("div",[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":80}},[r("FormItem",{attrs:{label:"组名",prop:"group_name"}},[r("i-input",{attrs:{placeholder:"请输入组名",clearable:""},model:{value:e.form.group_name,callback:function(t){e.$set(e.form,"group_name",t)},expression:"form.group_name"}})],1),r("FormItem",{attrs:{label:"用户名",prop:"group_users"}},[r("i-select",{attrs:{filterable:"",multiple:"",clearable:""},model:{value:e.form.group_users,callback:function(t){e.$set(e.form,"group_users",t)},expression:"form.group_users"}},e._l(e.userList,(function(t,n){return r("Option",{key:n,attrs:{value:t.id}},[e._v(" "+e._s(t.bk_username+"("+t.chname+")")+" ")])})),1)],1),r("FormItem",{attrs:{label:"说明",prop:"desc"}},[r("i-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入说明"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1),r("div",{staticClass:"center",attrs:{slot:"footer"},slot:"footer"},[r("Button",{staticClass:"mr-15",attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),r("Button",{on:{click:e.cancel}},[e._v("取消")])],1)])],1)},C=[],_=(r("d3b7"),r("3ca3"),r("ddb0"),r("5530")),$={name:"Group",components:{CwTable:c["a"]},data:function(){return{formInline:{group_name:""},loading:!1,columns:[{title:"组名",key:"group_name",align:"center"},{title:"成员",key:"group_users",align:"center",tooltip:!0},{title:"添加时间",key:"group_time",align:"center"},{title:"描述",key:"desc",align:"center"},{title:"操作",slot:"menu",align:"center",width:"150px"}],data:[],page:{currentPage:1,total:0,pageSize:10},isAdd:!0,modelVisible:!1,userList:[],form:{group_name:"",group_users:[],desc:""},rules:{group_name:[{required:!0,message:"请输入组名",trigger:"blur"}],group_users:[{required:!0,type:"array",message:"请选择用户",trigger:"change"}]}}},created:function(){Promise.all([this.getAllLocalUser(),this.query()]).then()},methods:{getAllLocalUser:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.sys.getAllLocalUser({});case 3:r=t.sent,r.result?e.userList=r.data:e.$CwMessage("error",r.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$CwMessage("error",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},search:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.query();case 2:case"end":return t.stop()}}),t)})))()},query:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.$api.sys.getGroup({params:e.formInline,num:e.page.pageSize,page:e.page.currentPage});case 4:r=t.sent,e.loading=!1,r.result?(e.page.total=r.data.total,e.data=r.data.data):e.$CwMessage("error",r.message),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.loading=!1,e.$CwMessage("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},sizeChange:function(e){this.page.currentPage=1,this.page.pageSize=e,this.query().then()},currentChange:function(e){this.page.currentPage=e,this.query().then()},create:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.handleReset("form"),e.modelVisible=!0,e.isAdd=!0;case 3:case"end":return t.stop()}}),t)})))()},update:function(e){this.modelVisible=!0,this.isAdd=!1,this.form=Object(_["a"])({},e),this.form["group_users"]=JSON.parse(this.form.group_users_id)},save:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=10;break}if(!e.isAdd){t.next=6;break}return t.next=4,e.add();case 4:t.next=8;break;case 6:return t.next=8,e.edit();case 8:t.next=11;break;case 10:e.$CwMessage("error","请完善资料");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},add:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$Spin.show(),t.prev=1,t.next=4,e.$api.sys.addGroup({data:JSON.stringify(e.form)});case 4:if(r=t.sent,e.$Spin.hide(),!r.result){t.next=13;break}return e.modelVisible=!1,e.$CwMessage("success","添加成功"),t.next=11,e.query();case 11:t.next=14;break;case 13:e.$CwMessage("error",r.message);case 14:t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](1),e.$Spin.hide(),e.$CwMessage("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[1,16]])})))()},edit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$Spin.show(),t.prev=1,t.next=4,e.$api.sys.editGroup({data:JSON.stringify(e.form)});case 4:if(r=t.sent,e.$Spin.hide(),!r.result){t.next=13;break}return e.modelVisible=!1,e.$CwMessage("success","编辑成功"),t.next=11,e.query();case 11:t.next=14;break;case 13:e.$CwMessage("error",r.message);case 14:t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](1),e.$Spin.hide(),e.$CwMessage("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[1,16]])})))()},cancel:function(){this.modelVisible=!1},remove:function(e){var t=this;this.$CWConfirm({type:"error",title:"删除",content:"是否删除这条数据",okText:"删除",cancelText:"取消"}).then(Object(o["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.sys.deleteGroup({id:e.id});case 3:if(n=r.sent,!n.result){r.next=10;break}return t.$CwMessage("success","删除成功"),r.next=8,t.query();case 8:r.next=11;break;case 10:t.$CwMessage("error",n.message);case 11:r.next=16;break;case 13:r.prev=13,r.t0=r["catch"](0),t.$CwMessage("error",r.t0);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))).catch((function(){}))},handleReset:function(e){this.$refs[e].resetFields()}}},I=$,S=Object(f["a"])(I,x,C,!1,null,"317a71c8",null),z=S.exports,O={name:"UserGroup",components:{Group:z,User:y},data:function(){return{uuid:this.$uuid.v4()}},methods:{tabChange:function(e){"group"===e&&(this.uuid=this.$uuid.v4())}}},R=O,B=(r("2d98"),Object(f["a"])(R,n,a,!1,null,"77c1fed4",null));t["default"]=B.exports},6516:function(e,t,r){},8068:function(e,t,r){"use strict";var n=r("a3af"),a=r.n(n);a.a},"945e":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"drawer-body"},[r("CwDrawerHeader",{attrs:{title:e.title},on:{"go-back":function(t){return e.goBack()}}}),r("div",{staticClass:"app-container"},[e._t("default")],2)],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"drawer-header"},[r("div",{staticClass:"back",on:{click:function(t){return t.stopPropagation(),e.goBack()}}},[r("Icon",{attrs:{type:"ios-arrow-forward"}})],1),r("p",{staticClass:"header-p"},[e._v(e._s(e.title))])])},i=[],o={name:"CwDrawerHeader",props:{title:{type:String,default:function(){return""}}},data:function(){return{}},methods:{goBack:function(){this.$emit("go-back")}}},c=o,u=r("2877"),l=Object(u["a"])(c,s,i,!1,null,"e6489ac0",null),p=l.exports,m={name:"CwDrawerBody",components:{CwDrawerHeader:p},props:{title:{type:String,required:!0}},methods:{goBack:function(){this.$emit("go-back")}}},d=m,g=Object(u["a"])(d,n,a,!1,null,"1c0407ea",null);t["a"]=g.exports},a3af:function(e,t,r){},a5c1:function(e,t,r){"use strict";var n=r("6516"),a=r.n(n);a.a},ab13:function(e,t,r){var n=r("b622"),a=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[a]=!1,"/./"[e](t)}catch(n){}}return!1}},caad:function(e,t,r){"use strict";var n=r("23e7"),a=r("4d64").includes,s=r("44d2"),i=r("ae40"),o=i("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:!o},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},f49b:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"cw-table"},[r("Table",{attrs:{border:e.border,stripe:e.stripe,loading:e.loading,columns:e.columns,data:e.data,size:e.size},scopedSlots:e._u([e._l(e.columns,(function(t){return{key:t.slot,fn:function(n){var a=n.row,s=n.index;return[t.slot?e._t(t.slot,null,{row:a,index:s}):r("span",{key:a[t.key]},[e._v(e._s(a[t.key]))])]}}}))],null,!0)}),r("div",{staticClass:"cw-table-page"},[r("Page",{attrs:{current:e.current,total:e.total,"show-total":e.showTotal,"show-sizer":e.showSizer,"prev-text":e.prevText,"next-text":e.nextText,"page-size":e.pageSize,"page-size-opts":e.pageSizeOpts,"show-elevator":""},on:{"on-change":e.onChange,"on-page-size-change":e.onPageSizeChange}})],1)],1)},a=[],s=(r("a9e3"),{name:"CwTable",props:{border:{type:Boolean,default:function(){return!0}},stripe:{type:Boolean,default:function(){return!0}},loading:{type:Boolean,default:function(){return!1}},size:{type:String,default:function(){return"small"}},columns:{type:Array,default:function(){return[]}},data:{type:Array,default:function(){return[]}},current:{type:Number,default:function(){return 1}},total:{type:Number,default:function(){return 0}},showTotal:{type:Boolean,default:function(){return!0}},showSizer:{type:Boolean,default:function(){return!0}},pageSize:{type:Number,default:function(){return 10}},pageSizeOpts:{type:Array,default:function(){return[10,20,30,40]}},prevText:{type:String,default:function(){return"上一页"}},nextText:{type:String,default:function(){return"下一页"}}},data:function(){return{}},methods:{onChange:function(e){this.$emit("current-change",e)},onPageSizeChange:function(e){this.$emit("size-change",e)}}}),i=s,o=(r("8068"),r("2877")),c=Object(o["a"])(i,n,a,!1,null,"cc375164",null);t["a"]=c.exports}}]);